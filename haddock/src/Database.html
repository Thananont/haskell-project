<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Database</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-5"></span><span>    </span><span class="annot"><a href="Database.html#dropAllTables"><span class="hs-identifier">dropAllTables</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-6"></span><span>    </span><span class="annot"><a href="Database.html#dumpDatabase"><span class="hs-identifier">dumpDatabase</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="Database.html#initTables"><span class="hs-identifier">initTables</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Database.html#insertModes"><span class="hs-identifier">insertModes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="Database.html#insertRoutesByMode"><span class="hs-identifier">insertRoutesByMode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Database.html#queryAllMode"><span class="hs-identifier">queryAllMode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Database.html#queryAllRoutes"><span class="hs-identifier">queryAllRoutes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Database.html#createDatabase"><span class="hs-identifier">createDatabase</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Database.html#printModeName"><span class="hs-identifier">printModeName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Database.html#fetchStops"><span class="hs-identifier">fetchStops</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Database.html#printMatch"><span class="hs-identifier">printMatch</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Database.html#queryAllDisruptions"><span class="hs-identifier">queryAllDisruptions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Database.html#printDisruptions"><span class="hs-identifier">printDisruptions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Database.html#queryAllStopPoints"><span class="hs-identifier">queryAllStopPoints</span></a></span><span>
</span><span id="line-19"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Char</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Types.html"><span class="hs-identifier">Types</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Database.SQLite.Simple</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Simple</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy.Char8</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L8</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Parse.html"><span class="hs-identifier">Parse</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="annot"><a href="Database.html#fromBool"><span class="hs-identifier hs-type">fromBool</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-31"></span><span id="fromBool"><span class="annot"><span class="annottext">fromBool :: Bool -&gt; Int
</span><a href="Database.html#fromBool"><span class="hs-identifier hs-var hs-var">fromBool</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-32"></span><span class="annot"><a href="Database.html#fromBool"><span class="hs-identifier hs-var">fromBool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="annot"><a href="Database.html#createDatabase"><span class="hs-identifier hs-type">createDatabase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span>
</span><span id="line-35"></span><span id="createDatabase"><span class="annot"><span class="annottext">createDatabase :: IO Connection
</span><a href="Database.html#createDatabase"><span class="hs-identifier hs-var hs-var">createDatabase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO Connection
</span><span class="hs-identifier hs-var">open</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;haskell-project-database.db&quot;</span></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="annot"><a href="Database.html#initTables"><span class="hs-identifier hs-type">initTables</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span id="initTables"><span class="annot"><span class="annottext">initTables :: Connection -&gt; IO ()
</span><a href="Database.html#initTables"><span class="hs-identifier hs-var hs-var">initTables</span></a></span></span><span> </span><span id="local-6989586621679111721"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111721"><span class="hs-identifier hs-var">connection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO ()
</span><span class="hs-identifier hs-var">execute_</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111721"><span class="hs-identifier hs-var">connection</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;CREATE TABLE IF NOT EXISTS mode ( \
        \ modeName TEXT PRIMARY KEY, \
        \ isType TEXT, \
        \ isTflService INTEGER NOT NULL CHECK(isTflService IN (0, 1)), \
        \ isFarePaying INTEGER NOT NULL CHECK(isFarePaying IN (0, 1)), \
        \ isScheduledService INTEGER NOT NULL CHECK(isScheduledService IN (0, 1)) \
        \ )&quot;</span></span><span>
</span><span id="line-46"></span><span>    </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO ()
</span><span class="hs-identifier hs-var">execute_</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111721"><span class="hs-identifier hs-var">connection</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;CREATE TABLE IF NOT EXISTS route ( \
        \ routeId TEXT PRIMARY KEY, \ 
        \ routeIsType TEXT, \ 
        \ routeName TEXT, \
        \ routeModeName TEXT, \ 
        \ routeCreated TEXT, \ 
        \ routeModified TEXT, \
        \ FOREIGN KEY (routeModeName) REFERENCES mode (modeName) \
        \ )&quot;</span></span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO ()
</span><span class="hs-identifier hs-var">execute_</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111721"><span class="hs-identifier hs-var">connection</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;CREATE TABLE IF NOT EXISTS routesection ( \
        \ routeSectionName TEXT, \ 
        \ routeSectionIsType TEXT, \ 
        \ routeModeName TEXT, \
        \ routeId TEXT, \
        \ direction TEXT, \
        \ originationName TEXT, \ 
        \ destinationName TEXT, \ 
        \ originator TEXT, \ 
        \ destination TEXT, \ 
        \ validTo TEXT, \ 
        \ FOREIGN KEY (routeModeName) REFERENCES mode (modeName), \
        \ FOREIGN KEY (routeId) REFERENCES route (routeId) \
        \ )&quot;</span></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="annot"><a href="Database.html#dropAllTables"><span class="hs-identifier hs-type">dropAllTables</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span id="dropAllTables"><span class="annot"><span class="annottext">dropAllTables :: Connection -&gt; IO ()
</span><a href="Database.html#dropAllTables"><span class="hs-identifier hs-var hs-var">dropAllTables</span></a></span></span><span> </span><span id="local-6989586621679111723"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111723"><span class="hs-identifier hs-var">connection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-72"></span><span>    </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO ()
</span><span class="hs-identifier hs-var">execute_</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111723"><span class="hs-identifier hs-var">connection</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;DROP TABLE IF EXISTS mode&quot;</span></span><span>
</span><span id="line-73"></span><span>    </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO ()
</span><span class="hs-identifier hs-var">execute_</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111723"><span class="hs-identifier hs-var">connection</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;DROP TABLE IF EXISTS route&quot;</span></span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO ()
</span><span class="hs-identifier hs-var">execute_</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111723"><span class="hs-identifier hs-var">connection</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;DROP TABLE IF EXISTS routesection&quot;</span></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-comment">-- Function that takes the modes and map them to be insert into the table</span><span>
</span><span id="line-77"></span><span class="annot"><a href="Database.html#insertModes"><span class="hs-identifier hs-type">insertModes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Types.html#Mode"><span class="hs-identifier hs-type">Mode</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span id="insertModes"><span class="annot"><span class="annottext">insertModes :: Connection -&gt; [Mode] -&gt; IO ()
</span><a href="Database.html#insertModes"><span class="hs-identifier hs-var hs-var">insertModes</span></a></span></span><span> </span><span id="local-6989586621679111724"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111724"><span class="hs-identifier hs-var">connection</span></a></span></span><span> </span><span id="local-6989586621679111725"><span class="annot"><span class="annottext">[Mode]
</span><a href="#local-6989586621679111725"><span class="hs-identifier hs-var">modes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>            </span><span>
</span><span id="line-79"></span><span>    </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO ()
</span><span class="hs-identifier hs-var">execute_</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111724"><span class="hs-identifier hs-var">connection</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;CREATE TABLE IF NOT EXISTS mode ( \
        \ modeName TEXT PRIMARY KEY, \
        \ isType TEXT, \
        \ isTflService INTEGER NOT NULL CHECK(isTflService IN (0, 1)), \
        \ isFarePaying INTEGER NOT NULL CHECK(isFarePaying IN (0, 1)), \
        \ isScheduledService INTEGER NOT NULL CHECK(isScheduledService IN (0, 1)) \
        \ )&quot;</span></span><span>
</span><span id="line-86"></span><span>    </span><span class="annot"><span class="annottext">(Mode -&gt; IO ()) -&gt; [Mode] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Connection -&gt; Mode -&gt; IO ()
</span><a href="Database.html#executeInsertMode"><span class="hs-identifier hs-var">executeInsertMode</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111724"><span class="hs-identifier hs-var">connection</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Mode]
</span><a href="#local-6989586621679111725"><span class="hs-identifier hs-var">modes</span></a></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-comment">-- Function insert the modes to the table</span><span>
</span><span id="line-89"></span><span class="annot"><a href="Database.html#executeInsertMode"><span class="hs-identifier hs-type">executeInsertMode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Types.html#Mode"><span class="hs-identifier hs-type">Mode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span id="executeInsertMode"><span class="annot"><span class="annottext">executeInsertMode :: Connection -&gt; Mode -&gt; IO ()
</span><a href="Database.html#executeInsertMode"><span class="hs-identifier hs-var hs-var">executeInsertMode</span></a></span></span><span> </span><span id="local-6989586621679111728"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111728"><span class="hs-identifier hs-var">connection</span></a></span></span><span> </span><span id="local-6989586621679111729"><span class="annot"><span class="annottext">Mode
</span><a href="#local-6989586621679111729"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; ([Char], [Char], Int, Int, Int) -&gt; IO ()
forall q. ToRow q =&gt; Connection -&gt; Query -&gt; q -&gt; IO ()
</span><span class="hs-identifier hs-var">execute</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111728"><span class="hs-identifier hs-var">connection</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;INSERT INTO mode ( \
    \ modeName, \
    \ isType, \
    \ isTflService, \
    \ isFarePaying, \ 
    \ isScheduledService \ 
    \ ) VALUES (?,?,?,?,?)&quot;</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-97"></span><span>      </span><span class="annot"><span class="annottext">Mode -&gt; [Char]
</span><a href="Types.html#modeName"><span class="hs-identifier hs-var">modeName</span></a></span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="#local-6989586621679111729"><span class="hs-identifier hs-var">mode</span></a></span><span class="hs-special">,</span><span> </span><span>
</span><span id="line-98"></span><span>      </span><span class="annot"><span class="annottext">Mode -&gt; [Char]
</span><a href="Types.html#isType"><span class="hs-identifier hs-var">isType</span></a></span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="#local-6989586621679111729"><span class="hs-identifier hs-var">mode</span></a></span><span class="hs-special">,</span><span> </span><span>
</span><span id="line-99"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Int
</span><a href="Database.html#fromBool"><span class="hs-identifier hs-var">fromBool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mode -&gt; Bool
</span><a href="Types.html#isTflService"><span class="hs-identifier hs-var">isTflService</span></a></span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="#local-6989586621679111729"><span class="hs-identifier hs-var">mode</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-100"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Int
</span><a href="Database.html#fromBool"><span class="hs-identifier hs-var">fromBool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mode -&gt; Bool
</span><a href="Types.html#isFarePaying"><span class="hs-identifier hs-var">isFarePaying</span></a></span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="#local-6989586621679111729"><span class="hs-identifier hs-var">mode</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-101"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Int
</span><a href="Database.html#fromBool"><span class="hs-identifier hs-var">fromBool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mode -&gt; Bool
</span><a href="Types.html#isScheduledService"><span class="hs-identifier hs-var">isScheduledService</span></a></span><span> </span><span class="annot"><span class="annottext">Mode
</span><a href="#local-6989586621679111729"><span class="hs-identifier hs-var">mode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="hs-comment">-- Function that takes the routes and map them to be inserted into the table</span><span>
</span><span id="line-105"></span><span class="annot"><a href="Database.html#insertRoutesByMode"><span class="hs-identifier hs-type">insertRoutesByMode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Types.html#Route"><span class="hs-identifier hs-type">Route</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span id="insertRoutesByMode"><span class="annot"><span class="annottext">insertRoutesByMode :: Connection -&gt; [Route] -&gt; IO ()
</span><a href="Database.html#insertRoutesByMode"><span class="hs-identifier hs-var hs-var">insertRoutesByMode</span></a></span></span><span> </span><span id="local-6989586621679111736"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111736"><span class="hs-identifier hs-var">connection</span></a></span></span><span> </span><span id="local-6989586621679111737"><span class="annot"><span class="annottext">[Route]
</span><a href="#local-6989586621679111737"><span class="hs-identifier hs-var">routes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>            </span><span>
</span><span id="line-107"></span><span>    </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO ()
</span><span class="hs-identifier hs-var">execute_</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111736"><span class="hs-identifier hs-var">connection</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;CREATE TABLE IF NOT EXISTS route ( \
        \ routeId TEXT PRIMARY KEY, \ 
        \ routeIsType TEXT, \ 
        \ routeName TEXT, \
        \ routeModeName TEXT, \ 
        \ routeCreated TEXT, \ 
        \ routeModified TEXT, \
        \ FOREIGN KEY (routeModeName) REFERENCES mode (modeName) \
        \ )&quot;</span></span><span>
</span><span id="line-116"></span><span>    </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO ()
</span><span class="hs-identifier hs-var">execute_</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111736"><span class="hs-identifier hs-var">connection</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;CREATE TABLE IF NOT EXISTS routesection ( \
        \ routeSectionName TEXT, \ 
        \ routeSectionIsType TEXT, \ 
        \ routeModeName TEXT, \
        \ routeId TEXT, \
        \ direction TEXT, \
        \ originationName TEXT, \ 
        \ destinationName TEXT, \ 
        \ originator TEXT, \ 
        \ destination TEXT, \ 
        \ validTo TEXT, \ 
        \ FOREIGN KEY (routeModeName) REFERENCES mode (modeName), \
        \ FOREIGN KEY (routeId) REFERENCES route (routeId) \
        \ )&quot;</span></span><span>
</span><span id="line-130"></span><span>    </span><span class="annot"><span class="annottext">(Route -&gt; IO ()) -&gt; [Route] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Connection -&gt; Route -&gt; IO ()
</span><a href="Database.html#executeInsertRoute"><span class="hs-identifier hs-var">executeInsertRoute</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111736"><span class="hs-identifier hs-var">connection</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Route]
</span><a href="#local-6989586621679111737"><span class="hs-identifier hs-var">routes</span></a></span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="hs-comment">-- Function insert the routes to the table and map the sections to be inserted into a table</span><span>
</span><span id="line-133"></span><span class="annot"><a href="Database.html#executeInsertRoute"><span class="hs-identifier hs-type">executeInsertRoute</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Types.html#Route"><span class="hs-identifier hs-type">Route</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span id="executeInsertRoute"><span class="annot"><span class="annottext">executeInsertRoute :: Connection -&gt; Route -&gt; IO ()
</span><a href="Database.html#executeInsertRoute"><span class="hs-identifier hs-var hs-var">executeInsertRoute</span></a></span></span><span> </span><span id="local-6989586621679111739"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111739"><span class="hs-identifier hs-var">connection</span></a></span></span><span> </span><span id="local-6989586621679111740"><span class="annot"><span class="annottext">Route
</span><a href="#local-6989586621679111740"><span class="hs-identifier hs-var">route</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><span class="annottext">Connection
-&gt; Query
-&gt; ([Char], [Char], [Char], [Char], [Char], [Char])
-&gt; IO ()
forall q. ToRow q =&gt; Connection -&gt; Query -&gt; q -&gt; IO ()
</span><span class="hs-identifier hs-var">execute</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111739"><span class="hs-identifier hs-var">connection</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;INSERT INTO route ( \ 
        \ routeId, \
        \ routeIsType, \
        \ routeName, \
        \ routeModeName, \
        \ routeCreated, \ 
        \ routeModified \ 
        \ ) VALUES (?,?,?,?,?,?)&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Route -&gt; [Char]
</span><a href="Types.html#routeId"><span class="hs-identifier hs-var">routeId</span></a></span><span> </span><span class="annot"><span class="annottext">Route
</span><a href="#local-6989586621679111740"><span class="hs-identifier hs-var">route</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-143"></span><span>        </span><span class="annot"><span class="annottext">Route -&gt; [Char]
</span><a href="Types.html#routeIsType"><span class="hs-identifier hs-var">routeIsType</span></a></span><span> </span><span class="annot"><span class="annottext">Route
</span><a href="#local-6989586621679111740"><span class="hs-identifier hs-var">route</span></a></span><span class="hs-special">,</span><span> </span><span>
</span><span id="line-144"></span><span>        </span><span class="annot"><span class="annottext">Route -&gt; [Char]
</span><a href="Types.html#routeName"><span class="hs-identifier hs-var">routeName</span></a></span><span> </span><span class="annot"><span class="annottext">Route
</span><a href="#local-6989586621679111740"><span class="hs-identifier hs-var">route</span></a></span><span class="hs-special">,</span><span> </span><span>
</span><span id="line-145"></span><span>        </span><span class="annot"><span class="annottext">Route -&gt; [Char]
</span><a href="Types.html#routeModeName"><span class="hs-identifier hs-var">routeModeName</span></a></span><span> </span><span class="annot"><span class="annottext">Route
</span><a href="#local-6989586621679111740"><span class="hs-identifier hs-var">route</span></a></span><span class="hs-special">,</span><span> </span><span>
</span><span id="line-146"></span><span>        </span><span class="annot"><span class="annottext">Route -&gt; [Char]
</span><a href="Types.html#routeCreated"><span class="hs-identifier hs-var">routeCreated</span></a></span><span> </span><span class="annot"><span class="annottext">Route
</span><a href="#local-6989586621679111740"><span class="hs-identifier hs-var">route</span></a></span><span class="hs-special">,</span><span> </span><span>
</span><span id="line-147"></span><span>        </span><span class="annot"><span class="annottext">Route -&gt; [Char]
</span><a href="Types.html#routeModified"><span class="hs-identifier hs-var">routeModified</span></a></span><span> </span><span class="annot"><span class="annottext">Route
</span><a href="#local-6989586621679111740"><span class="hs-identifier hs-var">route</span></a></span><span>
</span><span id="line-148"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679111747"><span class="annot"><span class="annottext">routeSections :: [RouteSection]
</span><a href="#local-6989586621679111747"><span class="hs-identifier hs-var hs-var">routeSections</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Route -&gt; [RouteSection]
</span><a href="Types.html#routeRouteSections"><span class="hs-identifier hs-var">routeRouteSections</span></a></span><span> </span><span class="annot"><span class="annottext">Route
</span><a href="#local-6989586621679111740"><span class="hs-identifier hs-var">route</span></a></span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><span class="annottext">(RouteSection -&gt; IO ()) -&gt; [RouteSection] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Connection -&gt; [Char] -&gt; [Char] -&gt; RouteSection -&gt; IO ()
</span><a href="Database.html#executeInsertRouteSection"><span class="hs-identifier hs-var">executeInsertRouteSection</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111739"><span class="hs-identifier hs-var">connection</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Route -&gt; [Char]
</span><a href="Types.html#routeModeName"><span class="hs-identifier hs-var">routeModeName</span></a></span><span> </span><span class="annot"><span class="annottext">Route
</span><a href="#local-6989586621679111740"><span class="hs-identifier hs-var">route</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Route -&gt; [Char]
</span><a href="Types.html#routeId"><span class="hs-identifier hs-var">routeId</span></a></span><span> </span><span class="annot"><span class="annottext">Route
</span><a href="#local-6989586621679111740"><span class="hs-identifier hs-var">route</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[RouteSection]
</span><a href="#local-6989586621679111747"><span class="hs-identifier hs-var">routeSections</span></a></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-comment">-- Function insert the route sections</span><span>
</span><span id="line-153"></span><span class="annot"><a href="Database.html#executeInsertRouteSection"><span class="hs-identifier hs-type">executeInsertRouteSection</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Types.html#RouteSection"><span class="hs-identifier hs-type">RouteSection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span id="executeInsertRouteSection"><span class="annot"><span class="annottext">executeInsertRouteSection :: Connection -&gt; [Char] -&gt; [Char] -&gt; RouteSection -&gt; IO ()
</span><a href="Database.html#executeInsertRouteSection"><span class="hs-identifier hs-var hs-var">executeInsertRouteSection</span></a></span></span><span> </span><span id="local-6989586621679111750"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111750"><span class="hs-identifier hs-var">connection</span></a></span></span><span> </span><span id="local-6989586621679111751"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679111751"><span class="hs-identifier hs-var">routeModeName</span></a></span></span><span> </span><span id="local-6989586621679111752"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679111752"><span class="hs-identifier hs-var">routeId</span></a></span></span><span> </span><span id="local-6989586621679111753"><span class="annot"><span class="annottext">RouteSection
</span><a href="#local-6989586621679111753"><span class="hs-identifier hs-var">routeSection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-155"></span><span>    </span><span class="annot"><span class="annottext">Connection
-&gt; Query
-&gt; ([Char], [Char], [Char], [Char], [Char], [Char], [Char], [Char],
    [Char], [Char])
-&gt; IO ()
forall q. ToRow q =&gt; Connection -&gt; Query -&gt; q -&gt; IO ()
</span><span class="hs-identifier hs-var">execute</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111750"><span class="hs-identifier hs-var">connection</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;INSERT INTO routesection ( \ 
        \ routeSectionName, \
        \ routeSectionIsType, \
        \ routeModeName, \
        \ routeId, \
        \ direction, \
        \ originationName, \
        \ destinationName, \ 
        \ originator, \ 
        \ destination, \ 
        \ validTo \ 
        \ ) VALUES (?,?,?,?,?,?,?,?,?,?)&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RouteSection -&gt; [Char]
</span><a href="Types.html#routeSectionName"><span class="hs-identifier hs-var">routeSectionName</span></a></span><span> </span><span class="annot"><span class="annottext">RouteSection
</span><a href="#local-6989586621679111753"><span class="hs-identifier hs-var">routeSection</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-167"></span><span>        </span><span class="annot"><span class="annottext">RouteSection -&gt; [Char]
</span><a href="Types.html#routeSectionIsType"><span class="hs-identifier hs-var">routeSectionIsType</span></a></span><span> </span><span class="annot"><span class="annottext">RouteSection
</span><a href="#local-6989586621679111753"><span class="hs-identifier hs-var">routeSection</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-168"></span><span>        </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679111751"><span class="hs-identifier hs-var">routeModeName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-169"></span><span>        </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679111752"><span class="hs-identifier hs-var">routeId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-170"></span><span>        </span><span class="annot"><span class="annottext">RouteSection -&gt; [Char]
</span><a href="Types.html#direction"><span class="hs-identifier hs-var">direction</span></a></span><span> </span><span class="annot"><span class="annottext">RouteSection
</span><a href="#local-6989586621679111753"><span class="hs-identifier hs-var">routeSection</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-171"></span><span>        </span><span class="annot"><span class="annottext">RouteSection -&gt; [Char]
</span><a href="Types.html#originationName"><span class="hs-identifier hs-var">originationName</span></a></span><span> </span><span class="annot"><span class="annottext">RouteSection
</span><a href="#local-6989586621679111753"><span class="hs-identifier hs-var">routeSection</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-172"></span><span>        </span><span class="annot"><span class="annottext">RouteSection -&gt; [Char]
</span><a href="Types.html#destinationName"><span class="hs-identifier hs-var">destinationName</span></a></span><span> </span><span class="annot"><span class="annottext">RouteSection
</span><a href="#local-6989586621679111753"><span class="hs-identifier hs-var">routeSection</span></a></span><span class="hs-special">,</span><span> </span><span>
</span><span id="line-173"></span><span>        </span><span class="annot"><span class="annottext">RouteSection -&gt; [Char]
</span><a href="Types.html#originator"><span class="hs-identifier hs-var">originator</span></a></span><span> </span><span class="annot"><span class="annottext">RouteSection
</span><a href="#local-6989586621679111753"><span class="hs-identifier hs-var">routeSection</span></a></span><span class="hs-special">,</span><span> </span><span>
</span><span id="line-174"></span><span>        </span><span class="annot"><span class="annottext">RouteSection -&gt; [Char]
</span><a href="Types.html#destination"><span class="hs-identifier hs-var">destination</span></a></span><span> </span><span class="annot"><span class="annottext">RouteSection
</span><a href="#local-6989586621679111753"><span class="hs-identifier hs-var">routeSection</span></a></span><span class="hs-special">,</span><span> </span><span>
</span><span id="line-175"></span><span>        </span><span class="annot"><span class="annottext">RouteSection -&gt; [Char]
</span><a href="Types.html#validTo"><span class="hs-identifier hs-var">validTo</span></a></span><span> </span><span class="annot"><span class="annottext">RouteSection
</span><a href="#local-6989586621679111753"><span class="hs-identifier hs-var">routeSection</span></a></span><span>
</span><span id="line-176"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="annot"><a href="Database.html#dumpDatabase"><span class="hs-identifier hs-type">dumpDatabase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span id="dumpDatabase"><span class="annot"><span class="annottext">dumpDatabase :: Connection -&gt; IO ()
</span><a href="Database.html#dumpDatabase"><span class="hs-identifier hs-var hs-var">dumpDatabase</span></a></span></span><span> </span><span id="local-6989586621679111762"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111762"><span class="hs-identifier hs-var">connection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-180"></span><span>    </span><span id="local-6989586621679111763"><span class="annot"><span class="annottext">[ModeDB]
</span><a href="#local-6989586621679111763"><span class="hs-identifier hs-var">modes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; IO [ModeDB]
</span><a href="Database.html#fetchModeData"><span class="hs-identifier hs-var">fetchModeData</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111762"><span class="hs-identifier hs-var">connection</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span id="local-6989586621679111765"><span class="annot"><span class="annottext">[RouteDB]
</span><a href="#local-6989586621679111765"><span class="hs-identifier hs-var">routes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; IO [RouteDB]
</span><a href="Database.html#fetchRouteData"><span class="hs-identifier hs-var">fetchRouteData</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111762"><span class="hs-identifier hs-var">connection</span></a></span><span>
</span><span id="line-182"></span><span>    </span><span id="local-6989586621679111767"><span class="annot"><span class="annottext">[RouteSectionDB]
</span><a href="#local-6989586621679111767"><span class="hs-identifier hs-var">routeSections</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; IO [RouteSectionDB]
</span><a href="Database.html#fetchRouteSectionData"><span class="hs-identifier hs-var">fetchRouteSectionData</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111762"><span class="hs-identifier hs-var">connection</span></a></span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679111791"><span class="annot"><span class="annottext">jsonData :: ByteString
</span><a href="#local-6989586621679111791"><span class="hs-identifier hs-var hs-var">jsonData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">encode</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; ByteString) -&gt; Value -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><span class="hs-identifier hs-var">object</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;modes&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; [ModeDB] -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">[ModeDB]
</span><a href="#local-6989586621679111763"><span class="hs-identifier hs-var">modes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;routes&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; [RouteDB] -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">[RouteDB]
</span><a href="#local-6989586621679111765"><span class="hs-identifier hs-var">routes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;routeSections&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; [RouteSectionDB] -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">[RouteSectionDB]
</span><a href="#local-6989586621679111767"><span class="hs-identifier hs-var">routeSections</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-184"></span><span>    </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ByteString -&gt; IO ()
</span><span class="hs-identifier hs-var">L8.writeFile</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;data.json&quot;</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679111791"><span class="hs-identifier hs-var">jsonData</span></a></span><span>
</span><span id="line-185"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;The database data has been written to the JSON file!&quot;</span></span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span class="annot"><a href="Database.html#fetchModeData"><span class="hs-identifier hs-type">fetchModeData</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Types.html#ModeDB"><span class="hs-identifier hs-type">ModeDB</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-188"></span><span id="fetchModeData"><span class="annot"><span class="annottext">fetchModeData :: Connection -&gt; IO [ModeDB]
</span><a href="Database.html#fetchModeData"><span class="hs-identifier hs-var hs-var">fetchModeData</span></a></span></span><span> </span><span id="local-6989586621679111797"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111797"><span class="hs-identifier hs-var">connection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-189"></span><span>    </span><span id="local-6989586621679111798"><span class="annot"><span class="annottext">[ModeDB]
</span><a href="#local-6989586621679111798"><span class="hs-identifier hs-var">modes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO [ModeDB]
forall r. FromRow r =&gt; Connection -&gt; Query -&gt; IO [r]
</span><span class="hs-identifier hs-var">query_</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111797"><span class="hs-identifier hs-var">connection</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;SELECT isType, isTflService, isFarePaying, isScheduledService, modeName FROM mode&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Types.html#ModeDB"><span class="hs-identifier hs-type">ModeDB</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-190"></span><span>    </span><span class="annot"><span class="annottext">[ModeDB] -&gt; IO [ModeDB]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[ModeDB]
</span><a href="#local-6989586621679111798"><span class="hs-identifier hs-var">modes</span></a></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="annot"><a href="Database.html#fetchRouteData"><span class="hs-identifier hs-type">fetchRouteData</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Types.html#RouteDB"><span class="hs-identifier hs-type">RouteDB</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-193"></span><span id="fetchRouteData"><span class="annot"><span class="annottext">fetchRouteData :: Connection -&gt; IO [RouteDB]
</span><a href="Database.html#fetchRouteData"><span class="hs-identifier hs-var hs-var">fetchRouteData</span></a></span></span><span> </span><span id="local-6989586621679111800"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111800"><span class="hs-identifier hs-var">connection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-194"></span><span>    </span><span id="local-6989586621679111801"><span class="annot"><span class="annottext">[RouteDB]
</span><a href="#local-6989586621679111801"><span class="hs-identifier hs-var">routes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO [RouteDB]
forall r. FromRow r =&gt; Connection -&gt; Query -&gt; IO [r]
</span><span class="hs-identifier hs-var">query_</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111800"><span class="hs-identifier hs-var">connection</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;SELECT routeIsType, routeName, routeModeName, routeCreated, routeModified, routeModeName FROM route&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Types.html#RouteDB"><span class="hs-identifier hs-type">RouteDB</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-195"></span><span>    </span><span class="annot"><span class="annottext">[RouteDB] -&gt; IO [RouteDB]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[RouteDB]
</span><a href="#local-6989586621679111801"><span class="hs-identifier hs-var">routes</span></a></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span class="annot"><a href="Database.html#fetchRouteSectionData"><span class="hs-identifier hs-type">fetchRouteSectionData</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Types.html#RouteSectionDB"><span class="hs-identifier hs-type">RouteSectionDB</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-198"></span><span id="fetchRouteSectionData"><span class="annot"><span class="annottext">fetchRouteSectionData :: Connection -&gt; IO [RouteSectionDB]
</span><a href="Database.html#fetchRouteSectionData"><span class="hs-identifier hs-var hs-var">fetchRouteSectionData</span></a></span></span><span> </span><span id="local-6989586621679111802"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111802"><span class="hs-identifier hs-var">connection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-199"></span><span>    </span><span id="local-6989586621679111803"><span class="annot"><span class="annottext">[RouteSectionDB]
</span><a href="#local-6989586621679111803"><span class="hs-identifier hs-var">routeSections</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO [RouteSectionDB]
forall r. FromRow r =&gt; Connection -&gt; Query -&gt; IO [r]
</span><span class="hs-identifier hs-var">query_</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111802"><span class="hs-identifier hs-var">connection</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;SELECT routeSectionName, routeSectionIsType, routeModeName,routeId,direction,originationName, destinationName, originator, destination, validTo FROM routesection&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Types.html#RouteSectionDB"><span class="hs-identifier hs-type">RouteSectionDB</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-200"></span><span>    </span><span class="annot"><span class="annottext">[RouteSectionDB] -&gt; IO [RouteSectionDB]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[RouteSectionDB]
</span><a href="#local-6989586621679111803"><span class="hs-identifier hs-var">routeSections</span></a></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="annot"><span class="hs-comment">-- | Query to print all the modes </span></span><span>
</span><span id="line-203"></span><span class="annot"><a href="Database.html#queryAllMode"><span class="hs-identifier hs-type">queryAllMode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span>
</span><span id="line-204"></span><span id="queryAllMode"><span class="annot"><span class="annottext">queryAllMode :: Connection -&gt; IO [[Char]]
</span><a href="Database.html#queryAllMode"><span class="hs-identifier hs-var hs-var">queryAllMode</span></a></span></span><span> </span><span id="local-6989586621679111804"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111804"><span class="hs-identifier hs-var">connection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-205"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679111806"><span class="annot"><span class="annottext">selectQuery :: Query
</span><a href="#local-6989586621679111806"><span class="hs-identifier hs-var hs-var">selectQuery</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;SELECT modeName FROM mode&quot;</span></span><span>
</span><span id="line-206"></span><span>    </span><span id="local-6989586621679111807"><span class="annot"><span class="annottext">[Only [Char]]
</span><a href="#local-6989586621679111807"><span class="hs-identifier hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO [Only [Char]]
forall r. FromRow r =&gt; Connection -&gt; Query -&gt; IO [r]
</span><span class="hs-identifier hs-var">query_</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111804"><span class="hs-identifier hs-var">connection</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621679111806"><span class="hs-identifier hs-var">selectQuery</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Only</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span>
</span><span id="line-207"></span><span>    </span><span class="annot"><span class="annottext">[[Char]] -&gt; IO [[Char]]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([[Char]] -&gt; IO [[Char]]) -&gt; [[Char]] -&gt; IO [[Char]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Only [Char] -&gt; [Char]) -&gt; [Only [Char]] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Only [Char] -&gt; [Char]
forall a. Only a -&gt; a
</span><span class="hs-identifier hs-var">fromOnly</span></span><span> </span><span class="annot"><span class="annottext">[Only [Char]]
</span><a href="#local-6989586621679111807"><span class="hs-identifier hs-var">results</span></a></span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span class="annot"><span class="hs-comment">-- | Make the first letter of the string uppercase</span></span><span>
</span><span id="line-210"></span><span class="annot"><a href="Database.html#toUpperFirst"><span class="hs-identifier hs-type">toUpperFirst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-211"></span><span id="toUpperFirst"><span class="annot"><span class="annottext">toUpperFirst :: [Char] -&gt; [Char]
</span><a href="Database.html#toUpperFirst"><span class="hs-identifier hs-var hs-var">toUpperFirst</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-212"></span><span class="annot"><a href="Database.html#toUpperFirst"><span class="hs-identifier hs-var">toUpperFirst</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679111810"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679111810"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679111811"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679111811"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char
</span><span class="hs-identifier hs-var">toUpper</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679111810"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; [Char] -&gt; [Char]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679111811"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="annot"><span class="hs-comment">-- | Function to  print mode name with the first letter in uppercase</span></span><span>
</span><span id="line-215"></span><span class="annot"><a href="Database.html#printModeName"><span class="hs-identifier hs-type">printModeName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span id="printModeName"><span class="annot"><span class="annottext">printModeName :: [[Char]] -&gt; IO ()
</span><a href="Database.html#printModeName"><span class="hs-identifier hs-var hs-var">printModeName</span></a></span></span><span> </span><span id="local-6989586621679111813"><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621679111813"><span class="hs-identifier hs-var">modes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">([Char] -&gt; IO ()) -&gt; [[Char]] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; IO ()) -&gt; ([Char] -&gt; [Char]) -&gt; [Char] -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char]
</span><a href="Database.html#toUpperFirst"><span class="hs-identifier hs-var">toUpperFirst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[Char]]
</span><a href="#local-6989586621679111813"><span class="hs-identifier hs-var">modes</span></a></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span class="hs-comment">-- | EXTRA FEARURES IMPLEMENTATION</span><span>
</span><span id="line-219"></span><span class="hs-comment">-- | Query to print all the routes</span><span>
</span><span id="line-220"></span><span class="annot"><a href="Database.html#queryAllRoutes"><span class="hs-identifier hs-type">queryAllRoutes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span>
</span><span id="line-221"></span><span id="queryAllRoutes"><span class="annot"><span class="annottext">queryAllRoutes :: Connection -&gt; [Char] -&gt; IO [[Char]]
</span><a href="Database.html#queryAllRoutes"><span class="hs-identifier hs-var hs-var">queryAllRoutes</span></a></span></span><span> </span><span id="local-6989586621679111815"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111815"><span class="hs-identifier hs-var">connection</span></a></span></span><span> </span><span id="local-6989586621679111816"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679111816"><span class="hs-identifier hs-var">modeName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-222"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; IO ()) -&gt; [Char] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Please wait, looking for all available routes for the &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679111816"><span class="hs-identifier hs-var">modeName</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;...&quot;</span></span><span>
</span><span id="line-223"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; IO ()) -&gt; [Char] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;----------------------------------------------------------&quot;</span></span><span>
</span><span id="line-224"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679111818"><span class="annot"><span class="annottext">selectQuery :: Query
</span><a href="#local-6989586621679111818"><span class="hs-identifier hs-var hs-var">selectQuery</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;SELECT routeName FROM route WHERE routeModeName = :routeModeName&quot;</span></span><span>
</span><span id="line-225"></span><span>    </span><span id="local-6989586621679111819"><span class="annot"><span class="annottext">[Only [Char]]
</span><a href="#local-6989586621679111819"><span class="hs-identifier hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; [NamedParam] -&gt; IO [Only [Char]]
forall r.
FromRow r =&gt;
Connection -&gt; Query -&gt; [NamedParam] -&gt; IO [r]
</span><span class="hs-identifier hs-var">queryNamed</span></span><span>  </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111815"><span class="hs-identifier hs-var">connection</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621679111818"><span class="hs-identifier hs-var">selectQuery</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;:routeModeName&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Char] -&gt; NamedParam
forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><span class="hs-operator hs-var">:=</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679111816"><span class="hs-identifier hs-var">modeName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Only</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Only [Char]]
</span><a href="#local-6989586621679111819"><span class="hs-identifier hs-var">results</span></a></span><span> </span><span class="annot"><span class="annottext">[Only [Char]] -&gt; [Only [Char]] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-227"></span><span>        </span><span class="annot"><span class="annottext">[[Char]] -&gt; IO [[Char]]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;No routes found for this mode&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-228"></span><span>    </span><span class="hs-keyword">else</span><span>
</span><span id="line-229"></span><span>        </span><span class="annot"><span class="annottext">[[Char]] -&gt; IO [[Char]]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([[Char]] -&gt; IO [[Char]]) -&gt; [[Char]] -&gt; IO [[Char]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Only [Char] -&gt; [Char]) -&gt; [Only [Char]] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Only [Char] -&gt; [Char]
forall a. Only a -&gt; a
</span><span class="hs-identifier hs-var">fromOnly</span></span><span> </span><span class="annot"><span class="annottext">[Only [Char]]
</span><a href="#local-6989586621679111819"><span class="hs-identifier hs-var">results</span></a></span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span class="annot"><span class="hs-comment">-- | Query for all stop points</span></span><span>
</span><span id="line-232"></span><span class="annot"><a href="Database.html#queryAllStopPoints"><span class="hs-identifier hs-type">queryAllStopPoints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span>
</span><span id="line-233"></span><span id="queryAllStopPoints"><span class="annot"><span class="annottext">queryAllStopPoints :: Connection -&gt; [Char] -&gt; IO [[Char]]
</span><a href="Database.html#queryAllStopPoints"><span class="hs-identifier hs-var hs-var">queryAllStopPoints</span></a></span></span><span> </span><span id="local-6989586621679111822"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111822"><span class="hs-identifier hs-var">connection</span></a></span></span><span> </span><span id="local-6989586621679111823"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679111823"><span class="hs-identifier hs-var">modeName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-234"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; IO ()) -&gt; [Char] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Looking for stop points for &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679111823"><span class="hs-identifier hs-var">modeName</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;....&quot;</span></span><span>
</span><span id="line-235"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; IO ()) -&gt; [Char] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;----------------------------------------------------------&quot;</span></span><span>
</span><span id="line-236"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679111825"><span class="annot"><span class="annottext">selectQuery :: Query
</span><a href="#local-6989586621679111825"><span class="hs-identifier hs-var hs-var">selectQuery</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;SELECT routeSectionName FROM routesection WHERE routeModeName = :routeModeName&quot;</span></span><span>
</span><span id="line-237"></span><span>    </span><span id="local-6989586621679111826"><span class="annot"><span class="annottext">[Only [Char]]
</span><a href="#local-6989586621679111826"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; [NamedParam] -&gt; IO [Only [Char]]
forall r.
FromRow r =&gt;
Connection -&gt; Query -&gt; [NamedParam] -&gt; IO [r]
</span><span class="hs-identifier hs-var">queryNamed</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679111822"><span class="hs-identifier hs-var">connection</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621679111825"><span class="hs-identifier hs-var">selectQuery</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;:routeModeName&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Char] -&gt; NamedParam
forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><span class="hs-operator hs-var">:=</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679111823"><span class="hs-identifier hs-var">modeName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Only</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span>
</span><span id="line-238"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Only [Char]]
</span><a href="#local-6989586621679111826"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="annot"><span class="annottext">[Only [Char]] -&gt; [Only [Char]] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-239"></span><span>        </span><span class="annot"><span class="annottext">[[Char]] -&gt; IO [[Char]]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;No stop points found&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-240"></span><span>    </span><span class="hs-keyword">else</span><span>
</span><span id="line-241"></span><span>        </span><span class="annot"><span class="annottext">[[Char]] -&gt; IO [[Char]]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([[Char]] -&gt; IO [[Char]]) -&gt; [[Char]] -&gt; IO [[Char]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Only [Char] -&gt; [Char]) -&gt; [Only [Char]] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Only [Char] -&gt; [Char]
forall a. Only a -&gt; a
</span><span class="hs-identifier hs-var">fromOnly</span></span><span> </span><span class="annot"><span class="annottext">[Only [Char]]
</span><a href="#local-6989586621679111826"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span class="annot"><span class="hs-comment">-- | Query for the search function</span></span><span>
</span><span id="line-244"></span><span class="annot"><a href="Database.html#fetchStops"><span class="hs-identifier hs-type">fetchStops</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="Types.html#SearchDestination"><span class="hs-identifier hs-type">SearchDestination</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span id="fetchStops"><span class="annot"><span class="annottext">fetchStops :: [Char] -&gt; [Char] -&gt; IO (Either [Char] SearchDestination)
</span><a href="Database.html#fetchStops"><span class="hs-identifier hs-var hs-var">fetchStops</span></a></span></span><span> </span><span id="local-6989586621679111827"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679111827"><span class="hs-identifier hs-var">tflAppKey</span></a></span></span><span> </span><span id="local-6989586621679111828"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679111828"><span class="hs-identifier hs-var">searchDestination</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679111832"><span class="annot"><span class="annottext">searchUrl :: [Char]
</span><a href="#local-6989586621679111832"><span class="hs-identifier hs-var hs-var">searchUrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;https://api.tfl.gov.uk/StopPoint/Search/&quot;</span></span><span> </span><span>
</span><span id="line-247"></span><span>                  </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679111828"><span class="hs-identifier hs-var">searchDestination</span></a></span><span> </span><span>
</span><span id="line-248"></span><span>                  </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;?maxResults=10&amp;oysterOnly=false&amp;app_key=&quot;</span></span><span> </span><span>
</span><span id="line-249"></span><span>                  </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679111827"><span class="hs-identifier hs-var">tflAppKey</span></a></span><span>
</span><span id="line-250"></span><span>  </span><span id="local-6989586621679111833"><span class="annot"><span class="annottext">Response ByteString
</span><a href="#local-6989586621679111833"><span class="hs-identifier hs-var">response</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Request -&gt; IO (Response ByteString)
forall (m :: * -&gt; *).
MonadIO m =&gt;
Request -&gt; m (Response ByteString)
</span><span class="hs-identifier hs-var">httpLBS</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Request
</span><span class="hs-identifier hs-var">parseRequest_</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679111832"><span class="hs-identifier hs-var">searchUrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679111836"><span class="annot"><span class="annottext">body :: ByteString
</span><a href="#local-6989586621679111836"><span class="hs-identifier hs-var hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Response ByteString -&gt; ByteString
forall a. Response a -&gt; a
</span><span class="hs-identifier hs-var">getResponseBody</span></span><span> </span><span class="annot"><span class="annottext">Response ByteString
</span><a href="#local-6989586621679111833"><span class="hs-identifier hs-var">response</span></a></span><span>
</span><span id="line-252"></span><span>  </span><span class="annot"><span class="annottext">Either [Char] SearchDestination
-&gt; IO (Either [Char] SearchDestination)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Either [Char] SearchDestination
forall a. FromJSON a =&gt; ByteString -&gt; Either [Char] a
</span><span class="hs-identifier hs-var">eitherDecode</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679111836"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="Types.html#SearchDestination"><span class="hs-identifier hs-type">SearchDestination</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="annot"><span class="hs-comment">-- | Funtion to do a pretty print</span></span><span>
</span><span id="line-255"></span><span class="annot"><a href="Database.html#printMatch"><span class="hs-identifier hs-type">printMatch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#Match"><span class="hs-identifier hs-type">Match</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span id="printMatch"><span class="annot"><span class="annottext">printMatch :: Match -&gt; IO ()
</span><a href="Database.html#printMatch"><span class="hs-identifier hs-var hs-var">printMatch</span></a></span></span><span> </span><span id="local-6989586621679111839"><span class="annot"><span class="annottext">Match
</span><a href="#local-6989586621679111839"><span class="hs-identifier hs-var">match</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-257"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; IO ()) -&gt; [Char] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Name: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Match -&gt; [Char]
</span><a href="Types.html#searchName"><span class="hs-identifier hs-var">searchName</span></a></span><span> </span><span class="annot"><span class="annottext">Match
</span><a href="#local-6989586621679111839"><span class="hs-identifier hs-var">match</span></a></span><span>
</span><span id="line-258"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; IO ()) -&gt; [Char] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Available modes: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Match -&gt; [[Char]]
</span><a href="Types.html#modes"><span class="hs-identifier hs-var">modes</span></a></span><span> </span><span class="annot"><span class="annottext">Match
</span><a href="#local-6989586621679111839"><span class="hs-identifier hs-var">match</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-260"></span><span>           </span><span>
</span><span id="line-261"></span><span class="hs-comment">-- | Query to print all the disruptions</span><span>
</span><span id="line-262"></span><span class="hs-comment">-- | Funtion to print the disruption in a readble format </span><span>
</span><span id="line-263"></span><span class="annot"><a href="Database.html#printDisruptions"><span class="hs-identifier hs-type">printDisruptions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Types.html#DisruptionDetail"><span class="hs-identifier hs-type">DisruptionDetail</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span id="printDisruptions"><span class="annot"><span class="annottext">printDisruptions :: [Char] -&gt; [DisruptionDetail] -&gt; IO ()
</span><a href="Database.html#printDisruptions"><span class="hs-identifier hs-var hs-var">printDisruptions</span></a></span></span><span> </span><span id="local-6989586621679111843"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679111843"><span class="hs-identifier hs-var">modeName</span></a></span></span><span> </span><span id="local-6989586621679111844"><span class="annot"><span class="annottext">[DisruptionDetail]
</span><a href="#local-6989586621679111844"><span class="hs-identifier hs-var">disruptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-265"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; IO ()) -&gt; [Char] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Disruptions for Mode: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679111843"><span class="hs-identifier hs-var">modeName</span></a></span><span>
</span><span id="line-266"></span><span>    </span><span class="annot"><span class="annottext">(DisruptionDetail -&gt; IO ()) -&gt; [DisruptionDetail] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">DisruptionDetail -&gt; IO ()
</span><a href="Database.html#printDisruption"><span class="hs-identifier hs-var">printDisruption</span></a></span><span> </span><span class="annot"><span class="annottext">[DisruptionDetail]
</span><a href="#local-6989586621679111844"><span class="hs-identifier hs-var">disruptions</span></a></span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span class="annot"><span class="hs-comment">-- | Funtion to print non empty detials</span></span><span>
</span><span id="line-269"></span><span class="annot"><a href="Database.html#printDisruption"><span class="hs-identifier hs-type">printDisruption</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Types.html#DisruptionDetail"><span class="hs-identifier hs-type">DisruptionDetail</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span id="printDisruption"><span class="annot"><span class="annottext">printDisruption :: DisruptionDetail -&gt; IO ()
</span><a href="Database.html#printDisruption"><span class="hs-identifier hs-var hs-var">printDisruption</span></a></span></span><span> </span><span id="local-6989586621679111846"><span class="annot"><span class="annottext">DisruptionDetail
</span><a href="#local-6989586621679111846"><span class="hs-identifier hs-var">disruption</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-271"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679111847"><span class="annot"><span class="annottext">cat :: [Char]
</span><a href="#local-6989586621679111847"><span class="hs-identifier hs-var hs-var">cat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DisruptionDetail -&gt; [Char]
</span><a href="Types.html#category"><span class="hs-identifier hs-var">category</span></a></span><span> </span><span class="annot"><span class="annottext">DisruptionDetail
</span><a href="#local-6989586621679111846"><span class="hs-identifier hs-var">disruption</span></a></span><span>
</span><span id="line-272"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679111849"><span class="annot"><span class="annottext">desc :: [Char]
</span><a href="#local-6989586621679111849"><span class="hs-identifier hs-var hs-var">desc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DisruptionDetail -&gt; [Char]
</span><a href="Types.html#description"><span class="hs-identifier hs-var">description</span></a></span><span> </span><span class="annot"><span class="annottext">DisruptionDetail
</span><a href="#local-6989586621679111846"><span class="hs-identifier hs-var">disruption</span></a></span><span>
</span><span id="line-273"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679111851"><span class="annot"><span class="annottext">routes :: [AffectedRoute]
</span><a href="#local-6989586621679111851"><span class="hs-identifier hs-var hs-var">routes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DisruptionDetail -&gt; [AffectedRoute]
</span><a href="Types.html#affectedRoutes"><span class="hs-identifier hs-var">affectedRoutes</span></a></span><span> </span><span class="annot"><span class="annottext">DisruptionDetail
</span><a href="#local-6989586621679111846"><span class="hs-identifier hs-var">disruption</span></a></span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679111853"><span class="annot"><span class="annottext">stops :: [AffectedStop]
</span><a href="#local-6989586621679111853"><span class="hs-identifier hs-var hs-var">stops</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DisruptionDetail -&gt; [AffectedStop]
</span><a href="Types.html#affectedStops"><span class="hs-identifier hs-var">affectedStops</span></a></span><span> </span><span class="annot"><span class="annottext">DisruptionDetail
</span><a href="#local-6989586621679111846"><span class="hs-identifier hs-var">disruption</span></a></span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679111855"><span class="annot"><span class="annottext">update :: Maybe [Char]
</span><a href="#local-6989586621679111855"><span class="hs-identifier hs-var hs-var">update</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DisruptionDetail -&gt; Maybe [Char]
</span><a href="Types.html#lastUpdate"><span class="hs-identifier hs-var">lastUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">DisruptionDetail
</span><a href="#local-6989586621679111846"><span class="hs-identifier hs-var">disruption</span></a></span><span>
</span><span id="line-276"></span><span>    </span><span>
</span><span id="line-277"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679111847"><span class="hs-identifier hs-var">cat</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; IO ()) -&gt; [Char] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Category: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679111847"><span class="hs-identifier hs-var">cat</span></a></span><span>
</span><span id="line-278"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679111849"><span class="hs-identifier hs-var">desc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; IO ()) -&gt; [Char] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Description: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679111849"><span class="hs-identifier hs-var">desc</span></a></span><span>
</span><span id="line-279"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[AffectedRoute] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[AffectedRoute]
</span><a href="#local-6989586621679111851"><span class="hs-identifier hs-var">routes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; IO ()) -&gt; [Char] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Affected Routes: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(AffectedRoute -&gt; [Char]) -&gt; [AffectedRoute] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">AffectedRoute -&gt; [Char]
</span><a href="Types.html#affectedRouteName"><span class="hs-identifier hs-var">affectedRouteName</span></a></span><span> </span><span class="annot"><span class="annottext">[AffectedRoute]
</span><a href="#local-6989586621679111851"><span class="hs-identifier hs-var">routes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[AffectedStop] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[AffectedStop]
</span><a href="#local-6989586621679111853"><span class="hs-identifier hs-var">stops</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; IO ()) -&gt; [Char] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Affected Stops: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(AffectedStop -&gt; [Char]) -&gt; [AffectedStop] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">AffectedStop -&gt; [Char]
</span><a href="Types.html#affectedStopName"><span class="hs-identifier hs-var">affectedStopName</span></a></span><span> </span><span class="annot"><span class="annottext">[AffectedStop]
</span><a href="#local-6989586621679111853"><span class="hs-identifier hs-var">stops</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Bool) -&gt; [Char] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe [Char] -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Maybe [Char]
</span><a href="#local-6989586621679111855"><span class="hs-identifier hs-var">update</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; IO ()) -&gt; [Char] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Last Update: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Maybe [Char] -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Maybe [Char]
</span><a href="#local-6989586621679111855"><span class="hs-identifier hs-var">update</span></a></span><span>
</span><span id="line-282"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;-----------------------------------&quot;</span></span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span class="annot"><a href="Database.html#queryAllDisruptions"><span class="hs-identifier hs-type">queryAllDisruptions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L8.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Types.html#DisruptionDetail"><span class="hs-identifier hs-type">DisruptionDetail</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-285"></span><span id="queryAllDisruptions"><span class="annot"><span class="annottext">queryAllDisruptions :: [Char] -&gt; ByteString -&gt; IO [DisruptionDetail]
</span><a href="Database.html#queryAllDisruptions"><span class="hs-identifier hs-var hs-var">queryAllDisruptions</span></a></span></span><span> </span><span id="local-6989586621679111862"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679111862"><span class="hs-identifier hs-var">modeName</span></a></span></span><span> </span><span id="local-6989586621679111863"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679111863"><span class="hs-identifier hs-var">json</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-286"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either [Char] [DisruptionDetail]
</span><a href="Parse.html#parseDisruptions"><span class="hs-identifier hs-var">parseDisruptions</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679111863"><span class="hs-identifier hs-var">json</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-287"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679111865"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679111865"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-288"></span><span>            </span><span class="annot"><span class="annottext">[Char] -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; IO ()) -&gt; [Char] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Error in parsing disruptions: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679111865"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-289"></span><span>            </span><span class="annot"><span class="annottext">[DisruptionDetail] -&gt; IO [DisruptionDetail]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-290"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679111866"><span class="annot"><span class="annottext">[DisruptionDetail]
</span><a href="#local-6989586621679111866"><span class="hs-identifier hs-var">disruptions</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[DisruptionDetail] -&gt; IO [DisruptionDetail]
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[DisruptionDetail]
</span><a href="#local-6989586621679111866"><span class="hs-identifier hs-var">disruptions</span></a></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span></pre></body></html>